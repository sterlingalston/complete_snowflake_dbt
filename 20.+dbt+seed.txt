

- Link used in this video: https://www.coingecko.com/en/coins/bitcoin/historical_data


- Command used in this lecture (don't forget to change file name from btc-usd_max.csv to btc_usd_max.csv :

	dbt seed



***

Model whale_alert.sql updated:

***

WITH WHALES as (

select
output_address,
sum(output_value) as total_sent,
count(*) as tx_count

from {{ ref('stg_btc_transactions')}}

where output_value > 10

group by output_address
order by total_sent desc
),

LATEST_PRICE as (
	select
	price
	from {{ ref('btc_usd_max')}}
	where to_date(replace(snapped_at,' UTC','')) = current_date()
)

select
w.output_address,
w.total_sent,
w.tx_count,
(p.price * w.total_sent) as total_sent_usd
from WHALES w
cross join LATEST_PRICE p

***