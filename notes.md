### Commands

| command                     | description                          | example |
| --------------------------- | ------------------------------------ | ------- |
| dbt run                     | runs the entire model -- models only |         |
| dbt run select {model name} | runs a specific model; no sql needed |         |
| dbt build                   | models + tests + seeds + snapshots   |         |

### Development

- https://github.com/snowcertmalston4-boop/DBT_DEMO
- https://docs.getdbt.com/docs/install-dbt-extension
- power user for dbt
  - https://www.youtube.com/watch?v=s-XxqNE4T1s
- https://github.com/sharetheknowledge/DBT_DEMO/blob/main/models/stg_bike.sql

### Project File

{{}} -- jinja

{%%} -- logic/macros (functions)

` {{ ref('my_first_dbt_model') }}` -- references another model

`{{ config(materialized='table') }} -- placed in model sql file, materializes .sql as table/view`

dbt will always prioritize what is in the model itself, rather than global

```
select 
* 
from {{ source('demo', 'bike') }}

limit 10
```

a

```
select 
* 
from {{ ref('my_second_dbt_model') }}

limit 10
```

- the target folder in dbt shows the raw .sql that is generated by dbt after processing jinja templates
- "compiled/ shows rendered SQL, run/ shows executed SQL" because the
  compiled/ folder contains the SQL code generated after Jinja templates
  are processed, while the run/ folder contains the SQL that has been
  executed against the database, helping you understand both the
  transformation process and the results. This distinction is vital for
  debugging and validating your dbt models.

### Macros

- go in macro directory
- ![](assets\20250825_220434_image.png)
- calling the macro:

### Orchestration

- CREATE TASK (...) WAREHOUSE=(...) SCHEDULE='USING CRON 0 0 * * * UTC'
- CREATE TASK (...) WAREHOUSE = (...) [AFTER (TASK_NAME)] AS (...)
- If describing a task it needs to be resumed afterwards.
- ![](assets\20250826_155407_image.png)

### YML Files

sources.yml can be named src.yml

![](assets\20250826_205354_image.png)

schema.yml - all configurations for specific models

schema and sources can be merged, but they MUST BE UNDER MODELS folder

packages.yml will be at same level as dbt_project.yml

### Tests

- singular data tests are for singular column in singular model
- generic data tests are macros written in test block

### Incremental

{{ config(materialized='incremental') }}

{% if is_incremental() %}

{% endif %}

![](assets\20250826_222022_image.png)

![](assets\20250826_223126_image.png)

#### full refresh

dbt run -m (model name) --full-refresh

#### debug

dbt run -m (model name) --debug

#### incremental

{{ config(materialized='incremental',incremental_strategy='append')}}

### ephemeral

- actual definition meaning anything whose duration is extremely limited

![](assets\20250828_081849_image.png)

- better to use views as opposed to ephemeral for larger sets

### seeds

![](assets\20250828_190548_image.png)

- running dbt seed will upload seed files to snowflake
- seeds are static and not recommended if data is constantly changing

### changing the profile from dev to prod

![](assets\20250829_085632_image.png)

- changing the schema above from dbt_... to PROD
- ![](assets\20250829_085721_image.png)
- if you want to change the TARGET of the model when running it
  - ![](assets\20250829_085831_image.png)
  - will run with the configuration in the profiles.yml for the prod output

### Manifest.json

- C:\Users\sterl\Documents\Data Engineering\complete_snowflake_dbt\btc_project\BTC\target\manifest.json
- every time dbt run or compile, manifest.json is re-written

### creating a new profile

- editing the profiles.yml, you can add a new one and change the target
- ![](assets\20250829_133311_image.png)

### Defer

- https://docs.getdbt.com/reference/node-selection/defer
- ![](assets\20250829_152610_image.png)
- within the state folder place the manifest.json that was generated from running --target prod

### Cloning in DBT and SF

![](assets\20250829_154027_image.png)

![](assets\20250829_154208_image.png)

#### defer vs clone

- https://docs.getdbt.com/blog/to-defer-or-to-clone
-

# dbt Clone vs. Deferral: A Comprehensive Guide

## What is dbt Clone?

**dbt clone** is a new command in dbt 1.6 that uses native zero-copy clone functionality to copy entire schemas instantly and for free. It works by copying only metadata (not the actual data), creating two pointers to the same underlying data.

## Key Differences: Clone vs. Defer

### Implementation

* **Defer** : Implicit via`--defer` flag
* **Clone** : Explicit via`dbt clone` command

### How They Work

* **Defer** : Compares manifests and overrides`ref()` to point to pre-built models in source schema
* **Clone** : Uses zero-copy cloning or creates pointer views to copy objects from source to target

### Outputs

* **Defer** : Doesn't create objects itself; dbt may create objects only if they've changed
* **Clone** : Copies all objects from source to target schema, persisting after operation

## Capability Comparison

| Capability                                        | Defer | Clone |
| ------------------------------------------------- | ----- | ----- |
| Save time & cost by avoiding re-computation       | ✅    | ✅    |
| Create database objects for downstream tools (BI) | ❌    | ✅    |
| Safely modify objects in target schema            | ❌    | ✅    |
| Avoid creating new database objects               | ✅    | ❌    |
| Avoid data drift                                  | ✅    | ❌    |
| Support multiple dynamic sources                  | ✅    | ❌    |

## When to Use Each

### Use Clone For:

* **Testing staging datasets in BI** : Need production data copy available in downstream tools for safe iteration
* **Blue/Green deployments** : Build entire staging dataset, test it, then atomically promote to production
* **Creating sandboxes** : Safe experimentation with production data copies

### Use Defer For:

* **Slim CI** : Reference production models to speed up CI runs, only building changed models
* **Dynamic source switching** : Reference models from different environments (prod for unchanged, staging for modified)

## Rule of Thumb

* **Defer** : Better for**Continuous Integration (CI)** use cases
* **Clone** : Better for**Continuous Deployment (CD)** use cases

Both commands can be used together within the same project at different stages of the deployment lifecycle.

### Python models

- can build models using python files!
- https://docs.getdbt.com/docs/build/python-models
- python models cannot be materialized as ephemeral or views, just tables
- packages need to be configured within model py

  - ![](assets\20250829_160017_image.png)
  - import {package name}
  - dbt.config(materialized = "table", packages = ["holidays"])
- needs to be converted to pandas dataframe
- python models must have all upper-case
- code to debug dbt model

  ### - ![](assets\20250901_220506_image.png)

  ### DBT Packages
- hub.getdbt.com
- packages yml in root directory
- run dbt deps to install
- example of macro
- ![](assets\20250901_221746_image.png)

### DBT Docs

- dbt docs generate
- target/run/catalog.json keeps all documentation on project
- dbt docs serve will run a server with dbt documents

### DBT Exposures Report Tracking w/ Looker

- looker google
- ![](assets\20250901_224314_image.png)
- place in schema.yml
- ![](assets\20250901_224703_image.png)

### Tests

- generic data tests
- ![](assets\20250902_090103_image.png)
- can go in tests folder, but macros folder as well
  - if in tests folder it needs to go in folder called 'generic'
  - ![](assets\20250902_090228_image.png)

### Contracts

- a guarantee that model will not change
- ![](assets\20250902_092848_image.png)
- columns must be listed with their own datatype
- ![](assets\20250902_095103_image.png)
-

### Versioning in dbt

![](assets\20250902_110620_image.png)

- need to specify latest version
- ![](assets\20250902_110711_image.png)
- create additional models with different versions to match the configuration in the schema
- ![](assets\20250902_111346_image.png)
- when referencing other models using ref, add 'v=#' argument:
- ![](assets\20250902_121750_image.png)
- enabling versions
- ![](assets\20250902_122726_image.png)
- there's also macro for creating latest version view macros
-  ![](assets\20250902_123001_image.png)
-
